<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.caasa.comexsap.exportaciones.model.persistence.extended.ConfiguracionExtendedMapper">
  <resultMap id="DominioMap" type="com.caasa.comexsap.exportaciones.model.to.DominioTO">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Jun 05 20:15:38 PET 2021.
    -->
    <id column="ID_DOMINIO" jdbcType="NUMERIC" property="idDominio" />
    <result column="APPCODE" jdbcType="VARCHAR" property="appcode" />
    <result column="CODIGO_DOMINIO" jdbcType="VARCHAR" property="codigoDominio" />
    <result column="DESCRIPCION" jdbcType="VARCHAR" property="descripcion" />
    <result column="CREADO_POR" jdbcType="VARCHAR" property="creadoPor" />
    <result column="FECHA_CREACION" jdbcType="TIMESTAMP" property="fechaCreacion" />
    <result column="MODIFICADO_POR" jdbcType="VARCHAR" property="modificadoPor" />
    <result column="FECHA_MODIFICACION" jdbcType="TIMESTAMP" property="fechaModificacion" />
    <result column="COD_ESTADO" jdbcType="VARCHAR" property="codEstado" />
    <result column="FLAG_CONFIG_SISTEMA" jdbcType="VARCHAR" property="flagConfigSistema" />
  </resultMap>
  <resultMap id="ParametroMap" type="com.caasa.comexsap.exportaciones.model.to.ParametroTO">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Jun 05 20:15:38 PET 2021.
    -->
    <id column="ID_PARAMETRO" jdbcType="NUMERIC" property="idParametro" />
    <result column="COD_ESTADO" jdbcType="VARCHAR" property="codEstado" />
    <result column="APPCODE" jdbcType="VARCHAR" property="appcode" />
    <result column="CODIGO_DOMINIO" jdbcType="VARCHAR" property="codigoDominio" />
    <result column="DESCRIPCION" jdbcType="VARCHAR" property="descripcion" />
    <result column="VALOR_PARAMETRO" jdbcType="VARCHAR" property="valorParametro" />
    <result column="VALOR_PARAMETRO2" jdbcType="VARCHAR" property="valorParametro2" />
    <result column="VALOR_PARAMETRO3" jdbcType="VARCHAR" property="valorParametro3" />
    <result column="VALOR_PARAMETRO4" jdbcType="VARCHAR" property="valorParametro4" />
    <result column="CREADO_POR" jdbcType="VARCHAR" property="creadoPor" />
    <result column="FECHA_CREACION" jdbcType="TIMESTAMP" property="fechaCreacion" />
    <result column="MODIFICADO_POR" jdbcType="VARCHAR" property="modificadoPor" />
    <result column="FECHA_MODIFICACION" jdbcType="TIMESTAMP" property="fechaModificacion" />
    <result column="CODIGO_DOMINIO_PADRE" jdbcType="VARCHAR" property="codigoDominioPadre" />
    <result column="VALOR_PARAMETRO_PADRE" jdbcType="VARCHAR" property="valorParametroPadre" />
  </resultMap>
  
  <resultMap id="ParametroV2Map" type="com.caasa.comexsap.exportaciones.model.to.ParametroTO">
    <id column="ID" jdbcType="NUMERIC" property="id" />
    <result column="DESCRIPCION" jdbcType="VARCHAR" property="descripcion" />
    <result column="CODIGO" jdbcType="VARCHAR" property="codigo" />
    <result column="CODIGODOMINIO" jdbcType="VARCHAR" property="codigoDominio" />
    <result column="NOMBREDOMINIO" jdbcType="VARCHAR" property="nombreDominio" />
    <result column="IDDOMINIO" jdbcType="NUMERIC" property="idDominio" />
    <result column="ESTADO" jdbcType="NUMERIC" property="estado" />
  </resultMap>
  
  <select id="listarDominio" resultMap="DominioMap">
	SELECT
	    ID_DOMINIO,
	    APPCODE,
	    CODIGO_DOMINIO,
	    DESCRIPCION,
	    CREADO_POR,
	    FECHA_CREACION,
	    MODIFICADO_POR,
	    FECHA_MODIFICACION,
	    COD_ESTADO,
	    FLAG_CONFIG_SISTEMA
	FROM
	    CONFIGT_DOMINIO
	WHERE
	    APPCODE = #{ codigoAplicacion } AND
	    COD_ESTADO = '1'
	ORDER BY CODIGO_DOMINIO ASC
  </select>
  <select id="listarParametroxDominio" parameterType="Map" resultMap="ParametroMap">
	  SELECT
	    ID_PARAMETRO,
	    COD_ESTADO,
	    APPCODE,
	    CODIGO_DOMINIO,
	    DESCRIPCION,
	    VALOR_PARAMETRO,
	    VALOR_PARAMETRO2,
	    VALOR_PARAMETRO3,
	    VALOR_PARAMETRO4,
	    CREADO_POR,
	    FECHA_CREACION,
	    MODIFICADO_POR,
	    FECHA_MODIFICACION,
	    CODIGO_DOMINIO_PADRE,
	    VALOR_PARAMETRO_PADRE
	FROM
	    CONFIGT_PARAMETRO
	WHERE
	    APPCODE = #{ codigoAplicacion } AND
	    CODIGO_DOMINIO = #{ codigoDominio } AND
	    COD_ESTADO = '1' AND 
	    DESCRIPCION IS NOT NULL
	ORDER BY ORDEN ASC, DESCRIPCION ASC
  </select>
  
  <select id="listarParametroxCodigoSap" parameterType="Map" resultMap="ParametroMap">
	  SELECT
	    ID_PARAMETRO,
	    COD_ESTADO,
	    APPCODE,
	    CODIGO_DOMINIO,
	    DESCRIPCION,
	    VALOR_PARAMETRO,
	    VALOR_PARAMETRO2,
	    VALOR_PARAMETRO3,
	    VALOR_PARAMETRO4,
	    CREADO_POR,
	    FECHA_CREACION,
	    MODIFICADO_POR,
	    FECHA_MODIFICACION,
	    CODIGO_DOMINIO_PADRE,
	    VALOR_PARAMETRO_PADRE
	FROM
	    CONFIGT_PARAMETRO
	WHERE
	    APPCODE = #{ codigoAplicacion } AND
	    CODIGO_DOMINIO = #{ codigoDominio } AND
	    VALOR_PARAMETRO = #{ codigoSap } AND
	    COD_ESTADO = '1' AND 
	    DESCRIPCION IS NOT NULL
	ORDER BY ORDEN ASC, DESCRIPCION ASC
  </select>
  
  <select id="buscarParametroxDominio" parameterType="Map" resultMap="ParametroMap">
	  SELECT
	    ID_PARAMETRO,
	    COD_ESTADO,
	    APPCODE,
	    CODIGO_DOMINIO,
	    DESCRIPCION,
	    VALOR_PARAMETRO,
	    VALOR_PARAMETRO2,
	    VALOR_PARAMETRO3,
	    VALOR_PARAMETRO4,
	    CREADO_POR,
	    FECHA_CREACION,
	    MODIFICADO_POR,
	    FECHA_MODIFICACION,
	    CODIGO_DOMINIO_PADRE,
	    VALOR_PARAMETRO_PADRE
	FROM
	    CONFIGT_PARAMETRO
	WHERE
	    APPCODE = #{ codigoAplicacion } AND
	    CODIGO_DOMINIO = #{ codigoDominio } AND
	    <if test="buscar != null and buscar != ''">
	    UPPER(CONCAT(VALOR_PARAMETRO || ' - ', DESCRIPCION)) LIKE '%' || UPPER(#{ buscar }) || '%' AND
	    </if>
	    COD_ESTADO = '1' AND 
	    DESCRIPCION IS NOT NULL
	    AND ROWNUM <![CDATA[ <= ]]> 50
	ORDER BY ORDEN ASC, DESCRIPCION ASC
  </select>

 
  <select id="obtenerPaisxParametro" resultMap="ParametroMap" parameterType="String">	  
	 SELECT
	    DESCRIPCION
	FROM
	    CONFIGT_PARAMETRO
	WHERE
	    APPCODE = #{codigoAplicacion} AND
	    COD_ESTADO = '1' AND 
	    CODIGO_DOMINIO = #{codigoDominio} AND
	    VALOR_PARAMETRO = #{valorParametro}
    AND ROWNUM <![CDATA[ <= ]]> 1
  </select> 
  
  <select id="listarParametroxFiltro" parameterType="String" resultMap="ParametroV2Map">
	SELECT * FROM (
		SELECT 
		    P.ID_PARAMETRO AS ID,
		    P.DESCRIPCION AS DESCRIPCION,
		    P.VALOR_PARAMETRO AS CODIGO,
		    D.ID_DOMINIO AS IDDOMINIO,
		    D.CODIGO_DOMINIO AS CODIGODOMINIO,
		    D.DESCRIPCION AS NOMBREDOMINIO,
		    P.COD_ESTADO AS ESTADO
		FROM CONFIGT_PARAMETRO P
		INNER JOIN CONFIGT_DOMINIO D ON D.CODIGO_DOMINIO = P.CODIGO_DOMINIO
		WHERE P.COD_ESTADO = 1
		<if test="dominios != null and dominios.length > 0">
			AND D.ID_DOMINIO IN 
			<foreach collection="dominios" item="item" open="(" close=")" separator=",">
			 #{item}
			</foreach>	
		</if>
		<if test="buscar != null">
			AND ( 
				UPPER(P.DESCRIPCION) LIKE '%' || UPPER(#{buscar}) || '%'
				OR
				UPPER(P.VALOR_PARAMETRO) LIKE '%' || UPPER(#{buscar}) || '%'
			)
		</if>
		ORDER BY P.FECHA_CREACION DESC
	)
	WHERE ROWNUM <![CDATA[ <= ]]> 200
	
  </select>
	<select id="existeCodigoParametroxDominio" parameterType="java.util.Map" resultType="int">
		SELECT COUNT(*) 
		FROM CONFIGT_PARAMETRO 
		WHERE CODIGO_DOMINIO = #{codigoDominio} 
		AND UPPER(VALOR_PARAMETRO) = UPPER(#{valorParametro})
		AND ID_PARAMETRO != #{idParametro,jdbcType=NUMERIC}
		AND COD_ESTADO = '1'
	</select>
</mapper>